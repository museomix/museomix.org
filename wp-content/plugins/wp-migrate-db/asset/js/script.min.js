var migration_complete,migration_complete_events,migrate_table_recursive,execute_next_step;!function(a){function b(a,b,c){return c=c||"0",a+="",a.length>=b?a:new Array(b-a.length+1).join(c)+a}function c(){w=0,counter_display=a(".timer"),label=wpmdb_i10n.time_elapsed+" ",s=setInterval(e,1e3)}function d(){hours=Math.floor(w/3600)%24,minutes=Math.floor(w/60)%60,seconds=w%60;var a=label+b(hours,2,0)+":"+b(minutes,2,0)+":"+b(seconds,2,0);counter_display.html(a)}function e(){w+=1,d()}function f(a,b){var c,d,e=[],f={},g=b.length;for(c=0;g>c;c++)f[b[c]]=!0;for(g=a.length,c=0;g>c;c++)d=a[c],d in f&&e.push(d);return e}function g(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null==c?"":decodeURIComponent(c[1].replace(/\+/g," "))}function h(b,c,d){var e=b.substr(0,b.indexOf(":"));return d!=e&&-1!=b.indexOf("https")?(a(".ssl-notice").show(),I=!0,b=b.replace("https","http"),void a(".pull-push-connection-info").val(b+"\n"+c)):void(I=!1)}function i(b,c){"undefined"!=typeof b&&b!=wpmdb_plugin_version&&(a(".different-plugin-version-notice").show(),a(".remote-version").html(b),a(".remote-location").html(c),a(".step-two").hide(),J=!0)}function j(b){b!=wpmdb_this_prefix&&(a(".remote-prefix").html(b),H=!0,a("#pull").is(":checked")?a(".prefix-notice.pull").show():a(".prefix-notice.push").show())}function k(a){var b=a,c=b.replace(/\/\/(.*)@/,"//").replace("http://","").replace("https://","").replace("www.","");return c}function l(a,b,c){var d,e,f=k(a);return"pull"==b?(d=wpmdb_i10n.pull_migration_label_migrating,e=wpmdb_i10n.pull_migration_label_completed):(d=wpmdb_i10n.push_migration_label_migrating,e=wpmdb_i10n.push_migration_label_completed),d=d.replace("%s",f),e=e.replace("%s",f),"migrating"==c?d:e}function m(a){return a.replace(/^https?:/i,"")}var n,o,p,q,r,s,t,u,v,w,x,y=!1,z="",A=!1,B=!1,C=!1,D=!1,E=!1,F=!1,G=!1,H=!1,I=!1,J=!1,K=!1,L=!1,M="",N="",O="",P=!1,Q=!1,R=ajaxurl.replace("/admin-ajax.php",""),S=R+"/images/wpspin_light";window.devicePixelRatio>=2&&(S+="-2x"),S+=".gif",window.onbeforeunload=function(a){return L?(a=a||window.event,a&&(a.returnValue=wpmdb_i10n.sure),wpmdb_i10n.sure):void 0},a(document).ready(function(){function b(b){a.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"wpmdb_check_licence",licence:b,nonce:wpmdb_nonces.check_licence},error:function(){alert(wpmdb_i10n.license_check_problem)},success:function(b){if("undefined"!=typeof b.errors){var c="";for(var d in b.errors)c+=b.errors[d];a(".support-content").empty().html(c),a(".addons-content").empty().html(c)}else a(".support-content").empty().html(b.message),a(".addons-content").empty().html(b.addon_content)}})}function d(){a(".option-group").each(function(){a("input",this).attr("disabled","disabled"),a("label",this).css("cursor","default")})}function w(){a(".option-group").each(function(){a("input",this).removeAttr("disabled"),a("label",this).css("cursor","pointer")})}function R(){var b=a("input[name=action]:checked").val(),c=a.trim(a(".pull-push-connection-info").val()).split("\n");if("undefined"!=typeof wpmdb_default_profile&&1!=wpmdb_default_profile&&"savefile"!=b&&!A&&wpmdb_is_pro){z=b,A=!0,d(),a(".connection-status").html(wpmdb_i10n.establishing_remote_connection),a(".connection-status").removeClass("notification-message error-notice migration-error"),a(".connection-status").append('<img src="'+S+'" alt="" class="ajax-spinner general-spinner" />');var e=a("input[name=action]:checked").val();a.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"wpmdb_verify_connection_to_remote_site",url:c[0],key:c[1],intent:e,nonce:wpmdb_nonces.verify_connection_to_remote_site,convert_post_type_selection:wpmdb_convert_post_type_selection,profile:wpmdb_profile},error:function(b){a(".connection-status").html(wpmdb_i10n.connection_local_server_problem+" (#102)"),a(".connection-status").append("<br /><br />"+wpmdb_i10n.status+": "+b.status+" "+b.statusText+"<br /><br />"+wpmdb_i10n.response+"<br />"+b.responseText),a(".connection-status").addClass("notification-message error-notice migration-error"),a(".ajax-spinner").remove(),A=!1,w()},success:function(b){if(a(".ajax-spinner").remove(),A=!1,w(),"undefined"!=typeof b.wpmdb_error&&1==b.wpmdb_error)return a(".connection-status").html(b.body),a(".connection-status").addClass("notification-message error-notice migration-error"),void(b.body.indexOf("401 Unauthorized")>-1&&a(".basic-access-auth-wrapper").show());h(c[0],c[1],b.scheme),i(b.plugin_version,c[0]),j(b.prefix),a(".pull-push-connection-info").addClass("temp-disabled"),a(".pull-push-connection-info").attr("readonly","readonly"),a(".connect-button").hide(),a(".connection-status").hide(),a(".step-two").show(),y=!0,connection_data=b,V();var d="";0==wpmdb_default_profile&&"undefined"!=typeof wpmdb_loaded_tables&&(d=wpmdb_loaded_tables);var e=document.createElement("select");a(e).attr({multiple:"multiple",name:"select_tables[]",id:"select-tables","class":"multiselect"}),a.each(connection_data.tables,function(b,c){var f=a.inArray(c,d);f=-1!=f?' selected="selected" ':" ",a(e).append("<option"+f+'value="'+c+'">'+c+" ("+connection_data.table_sizes_hr[c]+")</option>")}),ab=e;var f="";0==wpmdb_default_profile&&"undefined"!=typeof wpmdb_loaded_post_types&&("undefined"!=typeof b.select_post_types?(a("#exclude-post-types").attr("checked","checked"),a(".post-type-select-wrap").show(),f=b.select_post_types):f=wpmdb_loaded_post_types);var g=document.createElement("select");a(g).attr({multiple:"multiple",name:"select_post_types[]",id:"select-post-types","class":"multiselect"}),a.each(connection_data.post_types,function(b,c){var d=a.inArray(c,f);d=-1!=d||1==wpmdb_convert_exclude_revisions&&"revision"!=c?' selected="selected" ':" ",a(g).append("<option"+d+'value="'+c+'">'+c+"</option>")}),cb=g;var k="";0==wpmdb_default_profile&&"undefined"!=typeof wpmdb_loaded_tables_backup&&(k=wpmdb_loaded_tables_backup);var l=document.createElement("select");a(l).attr({multiple:"multiple",name:"select_backup[]",id:"select-backup","class":"multiselect"}),a.each(connection_data.tables,function(b,c){var d=a.inArray(c,k);d=-1!=d?' selected="selected" ':" ",a(l).append("<option"+d+'value="'+c+'">'+c+" ("+connection_data.table_sizes_hr[c]+")</option>")}),db=l,a("#pull").is(":checked")?(a("#select-tables").remove(),a(".select-tables-wrap").prepend(ab),a("#select-post-types").remove(),a(".select-post-types-wrap").prepend(cb),a("#select-backup").remove(),a(".backup-tables-wrap").prepend(eb),a(".table-prefix").html(b.prefix),a(".uploads-dir").html(wpmdb_this_uploads_dir)):(a("#select-backup").remove(),a(".backup-tables-wrap").prepend(db)),a.wpmdb.do_action("verify_connection_to_remote_site",connection_data)}})}}function T(){a.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpmdb_get_log",nonce:wpmdb_nonces.get_log},error:function(){alert(wpmdb_i10n.update_log_problem)},success:function(b){a(".debug-log-textarea").val(b)}})}function U(){var b=a(".progress-content").outerHeight();a(".progress-content").animate({top:"-"+b+"px"},400,"swing",function(){a("#overlay").remove(),a(".progress-content").remove()}),K=!1}function V(){a(".connection-status").hide(),a(".prefix-notice").hide(),a(".ssl-notice").hide(),a(".different-plugin-version-notice").hide(),a(".step-two").show(),a(".backup-options").show(),a(".keep-active-plugins").show(),a(".directory-permission-notice").hide(),a("#create-backup").removeAttr("disabled"),a("#create-backup-label").removeClass("disabled"),a(".backup-option-disabled").hide();a.trim(a(".pull-push-connection-info").val()).split("\n");if(a("#pull").is(":checked"))if(a(".pull-list li").append(connection_info_box),connection_info_box.show(),y){if(a(".connection-status").hide(),a(".step-two").show(),a(".table-prefix").html(connection_data.prefix),a(".uploads-dir").html(wpmdb_this_uploads_dir),0==F){var b=k(connection_data.url);a(".create-new-profile").val(b)}1==H&&a(".prefix-notice.pull").show(),1==I&&a(".ssl-notice").show(),1==J&&(a(".different-plugin-version-notice").show(),a(".step-two").hide()),a(".directory-scope").html("local"),0==wpmdb_write_permission&&(a("#create-backup").prop("checked",!1),a("#create-backup").attr("disabled","disabled"),a("#create-backup-label").addClass("disabled"),a(".backup-option-disabled").show(),a(".upload-directory-location").html(wpmdb_this_upload_dir_long))}else a(".connection-status").show(),a(".step-two").hide();else if(a("#push").is(":checked"))if(a(".push-list li").append(connection_info_box),connection_info_box.show(),y){if(a(".connection-status").hide(),a(".step-two").show(),a(".table-prefix").html(wpmdb_this_prefix),a(".uploads-dir").html(connection_data.uploads_dir),0==F){var b=k(connection_data.url);a(".create-new-profile").val(b)}1==H&&a(".prefix-notice.push").show(),1==I&&a(".ssl-notice").show(),1==J&&(a(".different-plugin-version-notice").show(),a(".step-two").hide()),a(".directory-scope").html("remote"),"0"==connection_data.write_permissions&&(a("#create-backup").prop("checked",!1),a("#create-backup").attr("disabled","disabled"),a("#create-backup-label").addClass("disabled"),a(".backup-option-disabled").show(),a(".upload-directory-location").html(connection_data.upload_dir_long))}else a(".connection-status").show(),a(".step-two").hide();else a("#savefile").is(":checked")&&(a(".connection-status").hide(),a(".step-two").show(),a(".table-prefix").html(wpmdb_this_prefix),0==F&&a(".create-new-profile").val(""),a(".backup-options").hide(),a(".keep-active-plugins").hide(),0==wpmdb_write_permission&&(a(".directory-permission-notice").show(),a(".step-two").hide()));a.wpmdb.do_action("move_connection_info_box")}function W(){a("#push").is(":checked")||a("#savefile").is(":checked")?((""==z||"pull"==z)&&a(".replace-row").each(function(){var b=a(".old-replace-col input",this).val();a(".old-replace-col input",this).val(a(".replace-right-col input",this).val()),a(".replace-right-col input",this).val(b)}),a("#select-tables").remove(),a(".select-tables-wrap").prepend(_),a("#select-post-types").remove(),a(".select-post-types-wrap").prepend(bb),a("#select-backup").remove(),a(".backup-tables-wrap").prepend(db),z="push"):a("#pull").is(":checked")&&((""==z||"push"==z)&&a(".replace-row").each(function(){var b=a(".old-replace-col input",this).val();a(".old-replace-col input",this).val(a(".replace-right-col input",this).val()),a(".replace-right-col input",this).val(b)}),a("#select-tables").remove(),a(".select-tables-wrap").prepend(ab),a("#select-post-types").remove(),a(".select-post-types-wrap").prepend(cb),a("#select-backup").remove(),a(".backup-tables-wrap").prepend(eb),z="pull")}function X(a){return/^([a-z]([a-z]|\d|\+|-|\.)*):(\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?((\[(|(v[\da-f]{1,}\.(([a-z]|\d|-|\.|_|~)|[!\$&'\(\)\*\+,;=]|:)+))\])|((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=])*)(:\d*)?)(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*|(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)|((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)|((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)){0})(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)}function Y(c,d){a(".nav-tab").removeClass("nav-tab-active"),a(".nav-tab."+c).addClass("nav-tab-active"),a(".content-tab").hide(),a("."+c+"-tab").show(),"help"==c&&(T(),"1"==wpmdb_has_licence&&(a(".support-content p").append('<img src="'+S+'" alt="" class="ajax-spinner general-spinner" />'),b(),G=!0)),"addons"==c&&1!=d&&"1"==wpmdb_has_licence&&(a(".addons-content p").append('<img src="'+S+'" alt="" class="ajax-spinner general-spinner" />'),b(),G=!0)}function Z(b){var c=a(".pull-push-connection-info");if(!A&&!a(c).hasClass("temp-disabled")){var b=a(".pull-push-connection-info").val(),e=a.trim(b).split("\n"),f=!1,g="";if(""==e&&(f=!0,g=wpmdb_i10n.connection_info_missing),2==e.length||f||(f=!0,g=wpmdb_i10n.connection_info_incorrect),f||X(e[0])||(f=!0,g=wpmdb_i10n.connection_info_url_invalid),f||32==e[1].length||(f=!0,g=wpmdb_i10n.connection_info_key_invalid),f||e[0]!=wpmdb_connection_info[0]||(f=!0,g=wpmdb_i10n.connection_info_local_url),f||e[1]!=wpmdb_connection_info[1]||(f=!0,g=wpmdb_i10n.connection_info_local_key),f)return a(".connection-status").html(g),void a(".connection-status").addClass("notification-message error-notice migration-error");if(0==wpmdb_openssl_available){e[0]=e[0].replace("https://","http://");var l=e[0]+"\n"+e[1];a(".pull-push-connection-info").val(l)}if(H=!1,A=!0,d(),a(".basic-access-auth-wrapper").is(":visible")){e[0]=e[0].replace(/\/\/(.*)@/,"//"),e[0]=e[0].replace("//","//"+encodeURIComponent(a.trim(a(".auth-username").val()))+":"+encodeURIComponent(a.trim(a(".auth-password").val()))+"@");var l=e[0]+"\n"+e[1];a(".pull-push-connection-info").val(l),a(".basic-access-auth-wrapper").hide()}a(".step-two").hide(),a(".ssl-notice").hide(),a(".prefix-notice").hide(),a(".connection-status").show(),a(".connection-status").html(wpmdb_i10n.establishing_remote_connection),a(".connection-status").removeClass("notification-message error-notice migration-error"),a(".connection-status").append('<img src="'+S+'" alt="" class="ajax-spinner general-spinner" />');var n=a("input[name=action]:checked").val();F=!1,a.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"wpmdb_verify_connection_to_remote_site",url:e[0],key:e[1],intent:n,nonce:wpmdb_nonces.verify_connection_to_remote_site},error:function(b){a(".connection-status").html(wpmdb_i10n.connection_local_server_problem+" (#100)"),a(".connection-status").append("<br /><br />"+wpmdb_i10n.status+": "+b.status+" "+b.statusText+"<br /><br />"+wpmdb_i10n.response+":<br />"+b.responseText),a(".connection-status").addClass("notification-message error-notice migration-error"),a(".ajax-spinner").remove(),A=!1,w()},success:function(b){if(a(".ajax-spinner").remove(),A=!1,w(),"undefined"!=typeof b.wpmdb_error&&1==b.wpmdb_error)return a(".connection-status").html(b.body),a(".connection-status").addClass("notification-message error-notice migration-error"),void(b.body.indexOf("401 Unauthorized")>-1&&a(".basic-access-auth-wrapper").show());var c=k(b.url);a(".create-new-profile").val(c),a(".pull-push-connection-info").addClass("temp-disabled"),a(".pull-push-connection-info").attr("readonly","readonly"),a(".connect-button").hide(),a(".connection-status").hide(),a(".step-two").show(),h(e[0],e[1],b.scheme),i(b.plugin_version,e[0]),j(b.prefix),y=!0,connection_data=b,V();var d=document.createElement("select");a(d).attr({multiple:"multiple",name:"select_tables[]",id:"select-tables","class":"multiselect"}),a.each(connection_data.tables,function(b,c){a(d).append('<option value="'+c+'">'+c+" ("+connection_data.table_sizes_hr[c]+")</option>")}),ab=d,db=a(d).clone(),a(db).attr({name:"select_backup[]",id:"select-backup"});var f=document.createElement("select");a(f).attr({multiple:"multiple",name:"select_post_types[]",id:"select-post-types","class":"multiselect"}),a.each(connection_data.post_types,function(b,c){a(f).append('<option value="'+c+'">'+c+"</option>")}),cb=f,a("#pull").is(":checked")?(a("#new-url").val(m(wpmdb_this_url)),a("#new-path").val(wpmdb_this_path),1==wpmdb_is_multisite&&a("#new-domain").val(wpmdb_this_domain),a("#old-url").val(m(b.url)),a("#old-path").val(b.path),a("#select-tables").remove(),a(".select-tables-wrap").prepend(ab),a("#select-post-types").remove(),a(".select-post-types-wrap").prepend(cb),a(".table-prefix").html(b.prefix),a(".uploads-dir").html(wpmdb_this_uploads_dir)):(a("#select-backup").remove(),a(".backup-tables-wrap").prepend(db),a("#new-url").val(m(b.url)),a("#new-path").val(b.path)),next_step_in_migration={fn:a.wpmdb.do_action,args:["verify_connection_to_remote_site",connection_data]},execute_next_step()}})}}a("#plugin-compatibility").change(function(){var b="1";if(a(this).is(":checked")){var c=confirm(wpmdb_i10n.mu_plugin_confirmation);if(!c)return void a(this).prop("checked",!1)}else b="0";a(".plugin-compatibility-wrap").toggle(),a(this).parent().append('<img src="'+S+'" alt="" class="ajax-spinner general-spinner" />'),a("#plugin-compatibility").attr("disabled","disabled"),a(".plugin-compatibility").addClass("disabled"),a.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpmdb_plugin_compatibility",install:b},error:function(b){alert(wpmdb_i10n.plugin_compatibility_settings_problem+"\r\n\r\n"+wpmdb_i10n.status+" "+b.status+" "+b.statusText+"\r\n\r\n"+wpmdb_i10n.response+"\r\n"+b.responseText),a(".ajax-spinner").remove(),a("#plugin-compatibility").removeAttr("disabled"),a(".plugin-compatibility").removeClass("disabled")},success:function(b){""!=a.trim(b)?alert(b):(a(".plugin-compatibility").append('<span class="ajax-success-msg">'+wpmdb_i10n.saved+"</span>"),a(".ajax-success-msg").fadeOut(2e3,function(){a(this).remove()})),a(".ajax-spinner").remove(),a("#plugin-compatibility").removeAttr("disabled"),a(".plugin-compatibility").removeClass("disabled")}})}),a("#plugin-compatibility").is(":checked")&&a(".plugin-compatibility-wrap").show(),(navigator.userAgent.indexOf("MSIE")>0||navigator.userAgent.indexOf("Trident")>0)&&a(".ie-warning").show(),0==wpmdb_valid_licence&&a("#savefile").prop("checked",!0),a(".slider").slider({range:"min",value:wpmdb_max_request/1024,min:512,max:wpmdb_bottleneck/1024,step:512,slide:function(b,c){a(".amount").html(wpmdb_add_commas(c.value)+" kB")},change:function(b,c){a(".amount").after('<img src="'+S+'" alt="" class="slider-spinner general-spinner" />'),a(".slider").slider("disable"),a.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"wpmdb_update_max_request_size",max_request_size:parseInt(c.value),nonce:wpmdb_nonces.update_max_request_size},error:function(){a(".slider").slider("enable"),a(".slider-spinner").remove(),alert(wpmdb_i10n.max_request_size_problem)},success:function(){a(".slider").slider("enable"),a(".slider-spinner").remove(),a(".slider-success-msg").show(),a(".slider-success-msg").fadeOut(2e3,function(){a(this).hide()})}})}}),a(".amount").html(wpmdb_add_commas(a(".slider").slider("value"))+" kB");var $=a(".progress-content").clone();a(".progress-content").remove();var _=a("#select-tables").clone(),ab=a("#select-tables").clone(),bb=a("#select-post-types").clone(),cb=a("#select-post-types").clone(),db=a("#select-backup").clone(),eb=a("#select-backup").clone();if(a(".help-tab .video").each(function(){var b=a(this),c=a(".video-viewer");a("a",this).click(function(d){d.preventDefault(),c.attr("src","//www.youtube.com/embed/"+b.data("video-id")+"?autoplay=1"),c.show();var e=c.offset();a(window).scrollTop(e.top-50)})}),a(".backup-options").show(),a(".keep-active-plugins").show(),a("#savefile").is(":checked")&&(a(".backup-options").hide(),a(".keep-active-plugins").hide()),R(),a(".js-action-link").click(function(b){b.preventDefault(),a(this).blur()}),a(".licence-form").submit(function(c){if(c.preventDefault(),!B){a(".licence-status").removeClass("notification-message error-notice success-notice");var d=a.trim(a(".licence-input").val());if(""==d)return a(".licence-status").addClass("notification-message error-notice"),void a(".licence-status").html(wpmdb_i10n.enter_license_key);a(".licence-status").empty().removeClass("success"),B=!0,a(".button.register-licence").after('<img src="'+S+'" alt="" class="register-licence-ajax-spinner general-spinner" />'),a.ajax({url:ajaxurl,type:"POST",dataType:"JSON",cache:!1,data:{action:"wpmdb_activate_licence",licence_key:d,nonce:wpmdb_nonces.activate_licence},error:function(){B=!1,a(".register-licence-ajax-spinner").remove(),a(".licence-status").html(wpmdb_i10n.register_license_problem)},success:function(c){if(B=!1,a(".register-licence-ajax-spinner").remove(),"undefined"!=typeof c.errors){var e="";for(var f in c.errors)e+=c.errors[f];a(".licence-status").html(e)}else"undefined"!=typeof c.wpmdb_error&&"undefined"!=typeof c.body?a(".licence-status").html(c.body):(a(".licence-input, .register-licence").remove(),a(".licence-not-entered").prepend(c.masked_licence),a(".licence-status").html(wpmdb_i10n.license_registered).delay(5e3).fadeOut(1e3),a(".licence-status").addClass("success notification-message success-notice"),a(".support-content").empty().html("<p>"+wpmdb_i10n.fetching_license+'<img src="'+S+'" alt="" class="ajax-spinner general-spinner" /></p>'),b(d),a(".invalid-licence").hide(),a(".migrate-selection label").removeClass("disabled"),a(".migrate-selection input").removeAttr("disabled"))}})}}),a(".clear-log").click(function(){a(".debug-log-textarea").val(""),a.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpmdb_clear_log",nonce:wpmdb_nonces.clear_log},error:function(){alert(wpmdb_i10n.clear_log_problem)},success:function(){}})}),a(".multiselect-select-all").click(function(){var b=a(this).parents(".select-wrap").children(".multiselect");a(b).focus(),a("option",b).attr("selected",1)}),a(".multiselect-deselect-all").click(function(){var b=a(this).parents(".select-wrap").children(".multiselect");a(b).focus(),a("option",b).removeAttr("selected")}),a(".multiselect-invert-selection").click(function(){var b=a(this).parents(".select-wrap").children(".multiselect");a(b).focus(),a("option",b).each(function(){a(this).attr("selected",!a(this).attr("selected"))})}),a(".option-group input[type=radio]").change(function(){group=a(this).closest(".option-group"),a("ul",group).hide(),parent=a(this).closest("li"),a("ul",parent).show()}),a(".option-group").each(function(){a(".option-group input[type=radio]").each(function(){a(this).is(":checked")&&(parent=a(this).closest("li"),a("ul",parent).show())})}),a(".header-expand-collapse").click(function(){a(".expand-collapse-arrow",this).hasClass("collapsed")?(a(".expand-collapse-arrow",this).removeClass("collapsed"),a(this).next().show()):(a(".expand-collapse-arrow",this).addClass("collapsed"),a(this).next().hide())}),a(".checkbox-label input[type=checkbox]").change(function(){a(this).is(":checked")?a(this).parent().next().show():a(this).parent().next().hide()}),a("#save-migration-profile").change(function(){a(this).is(":checked")?(a(".save-settings-button").show(),a(".migrate-db .button-primary").val(wpmdb_i10n.migrate_db_save)):(a(".save-settings-button").hide(),a(".migrate-db .button-primary").val(wpmdb_i10n.migrate_db))}),a("#save-migration-profile").is(":checked")&&(a(".save-settings-button").show(),a(".migrate-db .button-primary").val(wpmdb_i10n.migrate_db_save)),a(".checkbox-label input[type=checkbox]").each(function(){a(this).is(":checked")&&a(this).parent().next().show()}),a("#new-url").change(function(){a("#new-url-missing-warning").hide()}),a("#new-path").change(function(){a("#new-path-missing-warning").hide()}),a(".migrate-db-button").click(function(b){function d(b,c){var d=0;a.each(b,function(a,b){d+=parseInt(c[b])});var e="";if(a.each(b,function(b,f){var g=c[f]/d*100,h=Math.round(1e3*g)/1e3;a(".progress-tables").append('<div class="progress-chunk '+f+'_chunk" style="width: '+h+'%;" title="'+f+'"><span>'+f+"</span></div>"),a(".progress-tables-hover-boxes").append('<div class="progress-chunk-hover" data-table="'+f+'" style="width: '+h+'%;"></div>');a(".progress-tables .progress-chunk:last span");e=f}),a(".progress-chunk").each(function(d){function f(b){a("span",b).innerWidth()>a(b).width()&&a("span",b).hide()}a(this).width()<1&&b[d]!=e&&(a(this).hide(),a(".progress-chunk-hover[data-table="+b[d]+"]").hide(),c[e]=Number(c[e]),c[e]+=Number(c[b[d]]),c[b[d]]=0);var g=this;setTimeout(function(){f(g)},0)}),g=0,0!=c[e])var f=c[e]/d*100,g=Math.round(1e3*f)/1e3;a(".progress-tables .progress-chunk:last").css("width",g+"%"),a(".progress-chunk-hover:last").css("width",g+"%");var h=[c,d];return h}if(a(this).blur(),b.preventDefault(),a("#migrate-selected").is(":checked")&&null==a("#select-tables").val())return void alert(wpmdb_i10n.please_select_one_table);if(new_url_missing=!1,new_file_path_missing=!1,a("#new-url").length&&!a("#new-url").val()&&(a("#new-url-missing-warning").show(),a("#new-url").focus(),a("html,body").scrollTop(0),new_url_missing=!0),a("#new-path").length&&!a("#new-path").val()&&(a("#new-path-missing-warning").show(),0==new_url_missing&&(a("#new-path").focus(),a("html,body").scrollTop(0)),new_file_path_missing=!0),1!=new_url_missing&&1!=new_file_path_missing){if(a("#save-migration-profile").is(":checked")){if(""==a.trim(a(".create-new-profile").val())&&a("#create_new").is(":checked"))return alert(wpmdb_i10n.enter_name_for_profile),void a(".create-new-profile").focus();var e=!1;a("#create_new").is(":checked")&&(e=!0);var g=a(".create-new-profile").val();profile=a("#migrate-form").serialize(),a.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpmdb_save_profile",profile:profile,nonce:wpmdb_nonces.save_profile},error:function(){alert(wpmdb_i10n.save_profile_problem)},success:function(b){if(e){var c=parseInt(b,10),d=c+1,f='<li><span style="display: none;" class="delete-profile" data-profile-id="'+d+'"></span><label for="profile-'+d+'"><input id="profile-'+d+'" value="'+c+'" name="save_migration_profile_option" type="radio"> '+g+"</label></li>";a("#create_new").parents("li").before(f),a("#profile-"+d).attr("checked","checked"),a(".create-new-profile").val("")}}})}q=a("#migrate-form").serialize();var h=a(document).height();a("body").append('<div id="overlay"></div>'),a("#overlay").height(h).css({position:"fixed",top:0,left:0,width:"100%","z-index":99999,display:"none"}),$progress_content=$.clone(),n=a("input[name=action]:checked").val(),r="backup","savefile"==n&&(r="migrate"),0==a("#create-backup").is(":checked")&&(r="migrate");var i=a("input[name=table_migrate_option]:checked").val(),j=a.trim(a(".pull-push-connection-info").val()).split("\n"),k="";o=j[0],p=j[1];var m="";a("#overlay").after($progress_content),t=wpmdb_i10n.exporting_complete,"savefile"==n?m=wpmdb_i10n.exporting_please_wait:(m=l(o,n,"migrating"),t=l(o,n,"completed")),a(".progress-title").html(m),a("#overlay").show(),backup_option=a("input[name=backup_option]:checked").val(),table_option=a("input[name=table_migrate_option]:checked").val(),"backup"==r?("migrate_only_with_prefix"==table_option&&"backup_selected"==backup_option&&(backup_option="backup_only_with_prefix"),"push"==n?(k=connection_data.table_rows,"backup_only_with_prefix"==backup_option?O=connection_data.prefixed_tables:"backup_selected"==backup_option?(selected_tables=a("#select-tables").val(),O=f(selected_tables,connection_data.tables)):"backup_manual_select"==backup_option&&(O=a("#select-backup").val())):(k=wpmdb_this_table_rows,"backup_only_with_prefix"==backup_option?O=wpmdb_this_prefixed_tables:"backup_selected"==backup_option?(selected_tables=a("#select-tables").val(),O=f(selected_tables,wpmdb_this_tables)):"backup_manual_select"==backup_option&&(O=a("#select-backup").val()))):"migrate_select"==i?(O=a("#select-tables").val(),k="push"==n||"savefile"==n?wpmdb_this_table_rows:connection_data.table_rows):"push"==n||"savefile"==n?(O=wpmdb_this_prefixed_tables,k=wpmdb_this_table_rows):(O=connection_data.prefixed_tables,k=connection_data.table_rows),table_details=d(O,k),k=table_details[0],total_size=table_details[1],a(".progress-title").after('<img src="'+S+'" alt="" class="migration-progress-ajax-spinner general-spinner" />');var s=a(".progress-content").outerHeight();a(".progress-content").css("top","-"+s+"px").show().animate({top:"0px"}),c(),L=!0,a.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"wpmdb_initiate_migration",intent:n,url:o,key:p,form_data:q,stage:r,nonce:wpmdb_nonces.initiate_migration},error:function(b,c,d){a(".progress-title").html(wpmdb_i10n.migration_failed),a(".progress-text").html(wpmdb_i10n.connection_local_server_problem+" (#112)"),a(".progress-text").append("<br /><br />"+wpmdb_i10n.status+": "+b.status+" "+b.statusText+"<br /><br />"+wpmdb_i10n.response+":<br />"+b.responseText),a(".progress-text").addClass("migration-error"),console.log(b),console.log(c),console.log(d),migration_error=!0,migration_complete_events()},success:function(b){if("undefined"!=typeof b.wpmdb_error&&1==b.wpmdb_error)return migration_error=!0,migration_complete_events(),a(".progress-title").html(wpmdb_i10n.migration_failed),a(".progress-text").addClass("migration-error"),void a(".progress-text").html(b.body);N=b.dump_url,M=b.dump_filename;var c=0,e=0;x=0;var f=0,g=0,h=0,j=0;migrate_table_recursive=function(b,l){if(c>=O.length){if("backup"!=r)return hooks=a.wpmdb.apply_filters("wpmdb_before_migration_complete_hooks",hooks),hooks.push("migration_complete"),hooks=a.wpmdb.apply_filters("wpmdb_after_migration_complete_hooks",hooks),hooks.push("migration_complete_events"),next_step_in_migration={fn:wpmdb_call_next_hook},void execute_next_step();r="migrate",c=0,e=0,a(".progress-bar").width("0px"),"migrate_select"==i?(O=a("#select-tables").val(),k="push"==n||"savefile"==n?wpmdb_this_table_rows:connection_data.table_rows):"push"==n||"savefile"==n?(O=wpmdb_this_prefixed_tables,k=wpmdb_this_table_rows):(O=connection_data.prefixed_tables,k=connection_data.table_rows),a(".progress-tables").empty(),a(".progress-tables-hover-boxes").empty(),table_details=d(O,k),k=table_details[0],total_size=table_details[1]}a(".progress-text").html("backup"==r?x+"% - "+wpmdb_i10n.backing_up+' "'+O[c]+'"':x+"% - "+wpmdb_i10n.migrating+' "'+O[c]+'"'),last_table=0,c==O.length-1&&(last_table=1),gzip=0,"savefile"!=n&&1==parseInt(connection_data.gzip)&&(gzip=1);var m={action:"wpmdb_migrate_table",intent:n,url:o,key:p,table:O[c],form_data:q,stage:r,current_row:b,dump_filename:M,last_table:last_table,primary_keys:l,gzip:gzip,nonce:wpmdb_nonces.migrate_table};"savefile"!=n&&(m.bottleneck=connection_data.bottleneck,m.prefix=connection_data.prefix),connection_data&&connection_data.path_current_site&&connection_data.domain&&(m.path_current_site=connection_data.path_current_site,m.domain_current_site=connection_data.domain),A=!0,a.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,timeout:0,data:m,error:function(b,d,e){a(".progress-title").html(wpmdb_i10n.migration_failed),a(".progress-text").html(wpmdb_i10n.table_process_problem+" "+O[c]),a(".progress-text").append("<br /><br />"+wpmdb_i10n.status+": "+b.status+" "+b.statusText+"<br /><br />"+wpmdb_i10n.response+":<br />"+b.responseText),a(".progress-text").addClass("migration-error"),A=!1,console.log(b),console.log(d),console.log(e),migration_error=!0,migration_complete_events()},success:function(b){if(A=!1,b=a.trim(b),row_information=wpmdb_parse_json(b),0==row_information||null==row_information)return a(".progress-title").html(wpmdb_i10n.migration_failed),a(".progress-text").html(""==b||null==b?wpmdb_i10n.table_process_problem_empty_response+" "+O[c]:b),a(".progress-text").addClass("migration-error"),migration_error=!0,void migration_complete_events();if("undefined"!=typeof row_information.wpmdb_error&&1==row_information.wpmdb_error)return a(".progress-title").html(wpmdb_i10n.migration_failed),a(".progress-text").addClass("migration-error"),a(".progress-text").html(row_information.body),migration_error=!0,void migration_complete_events();"-1"==row_information.current_row?(e-=j,j=0,h=0,e+=parseInt(k[O[c]]),c++,row_information.current_row="",row_information.primary_keys=""):(g=parseInt(row_information.current_row),f=g-h,h=g,e+=f,j+=f);
var d=100*e/total_size;a(".progress-bar").width(d+"%"),x=Math.floor(d),next_step_in_migration={fn:migrate_table_recursive,args:[row_information.current_row,row_information.primary_keys]},execute_next_step()}})},next_step_in_migration={fn:migrate_table_recursive,args:["-1",""]},execute_next_step()}})}}),migration_complete_events=function(){0==migration_error&&(""==non_fatal_errors?("savefile"!=n&&1==a("#save_computer").is(":checked")&&a(".progress-text").css("visibility","hidden"),a(".progress-title").html(t).append('<div class="dashicons dashicons-yes"></div>')):(a(".progress-text").html(non_fatal_errors),a(".progress-text").addClass("migration-error"),a(".progress-title").html(wpmdb_i10n.completed_with_some_errors)),a(".progress-bar-wrapper").hide()),a(".migration-controls").hide(),hooks=[],call_stack=[],migration_error=!1,L=!1,K=!0,P=!1,Q=!1,A=!1,non_fatal_errors="",a(".progress-label").remove(),a(".migration-progress-ajax-spinner").remove(),a(".close-progress-content").show(),a("#overlay").css("cursor","pointer"),clearInterval(s)},migration_complete=function(){if(a(".migration-controls").fadeOut(),"savefile"==n){L=!1;var b=wpmdb_i10n.migration_complete;if(a("#save_computer").is(":checked")){var c=wpmdb_this_download_url+encodeURIComponent(M);a("#gzip_file").is(":checked")&&(c+="&gzip=1"),window.location=c}else b=wpmdb_i10n.completed_dump_located_at+' <a href="'+N+'">'+N+"</a>.";0==migration_error&&(a(".progress-text").html(b),migration_complete_events(),a(".progress-title").html(t))}else a(".progress-text").html(wpmdb_i10n.finalizing_migration),a.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpmdb_finalize_migration",intent:n,url:o,key:p,form_data:q,prefix:connection_data.prefix,temp_prefix:connection_data.temp_prefix,tables:O.join(","),nonce:wpmdb_nonces.finalize_migration},error:function(b,c,d){a(".progress-title").html(wpmdb_i10n.migration_failed),a(".progress-text").html(wpmdb_i10n.finalize_tables_problem),a(".progress-text").addClass("migration-error"),alert(b+" : "+c+" : "+d),migration_error=!0,migration_complete_events()},success:function(b){return""!=a.trim(b)?(a(".progress-title").html(wpmdb_i10n.migration_failed),a(".progress-text").html(b),a(".progress-text").addClass("migration-error"),migration_error=!0,void migration_complete_events()):(next_step_in_migration={fn:wpmdb_call_next_hook},void execute_next_step())}})},a("body").delegate(".close-progress-content-button","click",function(){U()}),a("body").delegate("#overlay","click",function(){1==K&&U()}),a(".save-settings-button").click(function(b){var c;if(a(this).blur(),b.preventDefault(),!D){if(a("#migrate-selected").is(":checked")&&null==a("#select-tables").val())return void alert(wpmdb_i10n.please_select_one_table);if(""==a.trim(a(".create-new-profile").val())&&a("#create_new").is(":checked"))return alert(wpmdb_i10n.enter_name_for_profile),void a(".create-new-profile").focus();var d=!1;a("#create_new").is(":checked")&&(d=!0);var e=a(".create-new-profile").val();D=!0,c=a("#migrate-form").serialize(),a(".save-settings-button").after('<img src="'+S+'" alt="" class="save-profile-ajax-spinner general-spinner" />'),a(this).attr("disabled","disabled"),a.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpmdb_save_profile",profile:c,nonce:wpmdb_nonces.save_profile},error:function(){alert(wpmdb_i10n.save_profile_problem),a(".save-settings-button").removeAttr("disabled"),a(".save-profile-ajax-spinner").remove(),a(".save-settings-button").after('<span class="ajax-success-msg">'+wpmdb_i10n.saved+"</span>"),a(".ajax-success-msg").fadeOut(2e3,function(){a(this).remove()}),D=!1},success:function(b){if(a(".save-settings-button").removeAttr("disabled"),a(".save-profile-ajax-spinner").remove(),a(".save-settings-button").after('<span class="ajax-success-msg">'+wpmdb_i10n.saved+"</span>"),a(".ajax-success-msg").fadeOut(2e3,function(){a(this).remove()}),D=!1,a(".create-new-profile").val(""),d){var c=parseInt(b,10),f=c+1,g='<li><span style="display: none;" class="delete-profile" data-profile-id="'+f+'"></span><label for="profile-'+f+'"><input id="profile-'+f+'" value="'+c+'" name="save_migration_profile_option" type="radio"> '+e+"</label></li>";a("#create_new").parents("li").before(g),a("#profile-"+f).attr("checked","checked")}}})}}),a("body").delegate(".progress-chunk-hover","mousemove",function(b){mX=b.pageX,offset=a(".progress-bar-wrapper").offset(),label_offset=a(".progress-label").outerWidth()/2,mX=mX-offset.left-label_offset,a(".progress-label").css("left",mX+"px"),a(".progress-label").html(a(this).attr("data-table"))}),a("body").delegate(".progress-chunk-hover","hover",function(b){"mouseenter"===b.type?a(".progress-label").addClass("label-visible"):a(".progress-label").removeClass("label-visible")}),connection_info_box=a(".connection-info-wrapper"),V(),a(".migrate-selection.option-group input[type=radio]").change(function(){V(),y&&W()}),!a("#pull").is(":checked")&&!a("#push").is(":checked")||y||(a(".step-two").hide(),a(".connection-status").show()),a(".general-helper").click(function(b){var c=a(this),d=a(this).next();a(".helper-message").not(d).hide();var e=c.position();d.css(d.hasClass("bottom")?{left:e.left-d.width()/2+"px",top:e.top+c.height()+9+"px"}:{left:e.left+c.width()+9+"px",top:e.top+c.height()/2-18+"px"}),d.toggle(),b.stopPropagation()}),a("body").click(function(){a(".helper-message").hide()}),a(".helper-message").click(function(a){a.stopPropagation()}),a(".nav-tab").click(function(){a(".nav-tab").removeClass("nav-tab-active"),a(this).addClass("nav-tab-active"),a(".content-tab").hide(),a("."+a(this).attr("data-div-name")).show();var c=a(this).attr("data-div-name");c=c.replace("-tab",""),window.location.hash=c,a(this).hasClass("help")&&(T(),0==G&&"1"==wpmdb_has_licence&&(a(".support-content p").append('<img src="'+S+'" alt="" class="ajax-spinner general-spinner" />'),b(),G=!0)),a(this).hasClass("addons")&&0==G&&"1"==wpmdb_has_licence&&(a(".addons-content p").append('<img src="'+S+'" alt="" class="ajax-spinner general-spinner" />'),b(),G=!0)}),a("body").delegate(".add-row","click",function(){a(this).parents("tr").before(a(".original-repeatable-field").clone().removeClass("original-repeatable-field"))}),a("body").delegate(".replace-remove-row","click",function(){a(this).parents("tr").remove(),a(".replace-row").length<2&&a(".no-replaces-message").show()}),a(".add-replace").click(function(){a(".replace-fields").prepend(a(".original-repeatable-field").clone().removeClass("original-repeatable-field")),a(".no-replaces-message").hide()}),a("body").delegate("#find-and-replace-sort tbody tr.replace-row","hover",function(b){"mouseenter"===b.type?a(".replace-remove-row",this).show():a(".replace-remove-row",this).hide()}),a("#find-and-replace-sort tbody").sortable({items:"> tr:not(.pin)",handle:"td:first",start:function(){a(".sort-handle").css("cursor","-webkit-grabbing"),a(".sort-handle").css("cursor","-moz-grabbing")},stop:function(){a(".sort-handle").css("cursor","-webkit-grab"),a(".sort-handle").css("cursor","-moz-grab")}}),a("body").delegate(".save-migration-profile-wrap li","hover",function(b){"mouseenter"===b.type?a(".delete-profile",this).show():a(".delete-profile",this).hide()}),window.location.hash){var fb=window.location.hash.substring(1);Y(fb,!1)}""!=g("install-plugin")&&(fb="addons",G=!0,Y(fb,!0)),a(".reset-api-key").click(function(){var b=confirm(wpmdb_i10n.reset_api_key);b&&!C&&(C=!0,a(".reset-api-key").after('<img src="'+S+'" alt="" class="reset-api-key-ajax-spinner general-spinner" />'),a.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpmdb_reset_api_key",nonce:wpmdb_nonces.reset_api_key},error:function(){alert(wpmdb_i10n.reset_api_key_problem),a(".reset-api-key-ajax-spinner").remove(),C=!1},success:function(b){a(".reset-api-key-ajax-spinner").remove(),C=!1,a(".connection-info").html(b)}}))}),a("input.multiselect-toggle").change(function(){a(this).parents(".expandable-content").children(".select-wrap").toggle()}),a(".show-multiselect").each(function(){a(this).is(":checked")&&(a(this).parents(".option-section").children(".header-expand-collapse").children(".expand-collapse-arrow").removeClass("collapsed"),a(this).parents(".expandable-content").show(),a(this).parents(".expandable-content").children(".select-wrap").toggle())}),a("input[name=backup_option]").change(function(){a(".backup-tables-wrap").hide(),"backup_manual_select"==a(this).val()&&a(".backup-tables-wrap").show()}),a("#backup-manual-select").is(":checked")&&a(".backup-tables-wrap").show(),a(".plugin-compatibility-save").click(function(){E||(a(this).addClass("disabled"),select_element=a("#selected-plugins"),a(select_element).attr("disabled","disabled"),E=!0,a(this).after('<img src="'+S+'" alt="" class="plugin-compatibility-spinner general-spinner" />'),a.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpmdb_blacklist_plugins",blacklist_plugins:a(select_element).val()},error:function(b){alert(wpmdb_i10n.blacklist_problem+"\r\n\r\n"+wpmdb_i10n.status+" "+b.status+" "+b.statusText+"\r\n\r\n"+wpmdb_i10n.response+"\r\n"+b.responseText),a(select_element).removeAttr("disabled"),a(".plugin-compatibility-save").removeClass("disabled"),E=!1,a(".plugin-compatibility-spinner").remove(),a(".plugin-compatibility-success-msg").show().fadeOut(2e3)},success:function(b){""!=a.trim(b)&&alert(b),a(select_element).removeAttr("disabled"),a(".plugin-compatibility-save").removeClass("disabled"),E=!1,a(".plugin-compatibility-spinner").remove(),a(".plugin-compatibility-success-msg").show().fadeOut(2e3)}}))}),a("body").delegate(".delete-profile","click",function(){var b=a(this).next().clone();a("input",b).remove();var b=a.trim(a(b).html()),c=confirm(wpmdb_i10n.remove_profile+' "'+b+'"');c&&(a(this).parent().fadeOut(500),a.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpmdb_delete_migration_profile",profile_id:a(this).attr("data-profile-id"),nonce:wpmdb_nonces.delete_migration_profile},error:function(){alert(wpmdb_i10n.remove_profile_problem)},success:function(a){"-1"==a&&alert(wpmdb_i10n.remove_profile_not_found)}}))}),a(".main-list-delete-profile-link").click(function(){var b=a(this).prev().html(),c=confirm(wpmdb_i10n.remove_profile+' "'+b+'"');c&&(a(this).parent().fadeOut(500),a.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpmdb_delete_migration_profile",profile_id:a(this).attr("data-profile-id"),nonce:wpmdb_nonces.delete_migration_profile},error:function(){alert(wpmdb_i10n.remove_profile_problem)}}))}),a("body").delegate(".temp-disabled","click",function(){var b=confirm(wpmdb_i10n.change_connection_info);b&&(a(".ssl-notice").hide(),a(".different-plugin-version-notice").hide(),a(".migrate-db-button").show(),a(".temp-disabled").removeAttr("readonly"),a(".temp-disabled").removeClass("temp-disabled"),a(".connect-button").show(),a(".step-two").hide(),a(".connection-status").show().html(wpmdb_i10n.enter_connection_info),y=!1)}),a(".settings-tab input[type=checkbox]").change(function(){if("plugin-compatibility"!=a(this).attr("id")){var b=a(this).is(":checked"),c=a(this).attr("id");a(this).parent().append('<img src="'+S+'" alt="" class="ajax-spinner general-spinner" />');var d=a(this).parent();a.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:{action:"wpmdb_save_setting",checked:b,setting:c,nonce:wpmdb_nonces.save_setting},error:function(){alert(wpmdb_i10n.save_settings_problem),a(".ajax-spinner").remove()},success:function(){a(".ajax-spinner").remove(),a(d).append('<span class="ajax-success-msg">'+wpmdb_i10n.saved+"</span>"),a(".ajax-success-msg").fadeOut(2e3,function(){a(this).remove()})}})}}),a(".migrate-form").submit(function(a){a.preventDefault()}),a(".connect-button").click(function(b){b.preventDefault(),a(this).blur(),Z()}),a(".pull-push-connection-info").bind("paste",function(){setTimeout(function(){Z()},0)}),a("body").delegate(".try-again","click",function(){Z()}),a("body").delegate(".try-http","click",function(){var b=a.trim(a(".pull-push-connection-info").val()).split("\n"),c=b[0].replace("https","http"),d=c+"\n"+b[1];a(".pull-push-connection-info").val(d),Z()}),a(".create-new-profile").change(function(){F=!0}),a("body").delegate(".temporarily-disable-ssl","click",function(){if(window.location.hash)var b=window.location.hash.substring(1);a(this).attr("href",a(this).attr("href")+"&hash="+b)}),a("body").delegate(".pause-resume","click",function(){1==P?(P=!1,A=!0,a(".progress-title").html(u),a(".progress-text").html(v),a(".migration-progress-ajax-spinner").show(),a(".pause-resume").html(wpmdb_i10n.pause),s=setInterval(e,1e3),execute_next_step()):(P=!0,A=!1,u=a(".progress-title").html(),v=a(".progress-text").html(),a(".progress-title").html(wpmdb_i10n.migration_paused),a(".pause-resume").html(wpmdb_i10n.resume),a(".progress-text").html(wpmdb_i10n.completing_current_request))}),a("body").delegate(".cancel","click",function(){Q=!0,P=!1,a(".progress-text").html(wpmdb_i10n.completing_current_request),a(".progress-title").html(wpmdb_i10n.cancelling_migration),a(".migration-controls").fadeOut(),a(".migration-progress-ajax-spinner").show(),0==A&&execute_next_step()}),a(".enter-licence").click(function(){a(".settings").click(),a(".licence-input").focus()}),execute_next_step=function(){if(1==P)return a(".migration-progress-ajax-spinner").hide(),clearInterval(s),void a(".progress-text").html(wpmdb_i10n.paused);if(1==Q){n=a("input[name=action]:checked").val(),"savefile"==n?progress_msg=wpmdb_i10n.removing_local_sql:"pull"==n?progress_msg="backup"==r?wpmdb_i10n.removing_local_backup:wpmdb_i10n.removing_local_temp_tables:"push"==n&&(progress_msg="backup"==r?wpmdb_i10n.removing_remote_sql:wpmdb_i10n.removing_remote_temp_tables),a(".progress-text").html(progress_msg);var b={action:"wpmdb_cancel_migration",intent:n,url:o,key:p,stage:r,dump_filename:M,form_data:q};"undefined"!=typeof connection_data&&(b.temp_prefix=connection_data.temp_prefix),a.ajax({url:ajaxurl,type:"POST",dataType:"text",cache:!1,data:b,error:function(b,c,d){a(".progress-title").html(wpmdb_i10n.migration_cancellation_failed),a(".progress-text").html(wpmdb_i10n.manually_remove_temp_files),a(".progress-text").append("<br /><br />"+wpmdb_i10n.status+": "+b.status+" "+b.statusText+"<br /><br />"+wpmdb_i10n.response+":<br />"+b.responseText),a(".progress-text").addClass("migration-error"),console.log(b),console.log(c),console.log(d),migration_error=!0,migration_complete_events()},success:function(b){return A=!1,b=a.trim(b),""!=b?(a(".progress-title").html(wpmdb_i10n.migration_cancellation_failed),a(".progress-text").html(b),a(".progress-text").addClass("migration-error"),migration_error=!0,void migration_complete_events()):(t=wpmdb_i10n.migration_cancelled,a(".progress-text").hide(),void migration_complete_events())}})}else next_step_in_migration.fn.apply(null,next_step_in_migration.args)}})}(jQuery);